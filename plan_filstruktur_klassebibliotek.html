<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan for Filstruktur og Klassebibliotek - IS-115 Prosjektoppgave</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        h2 {
            color: #34495e;
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin-top: 30px;
            margin-bottom: 20px;
        }
        h3 {
            color: #2c3e50;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        h4 {
            color: #34495e;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .file-structure {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
        }
        .highlight {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }
        .benefits {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
        .phase {
            background-color: #e2e3e5;
            border: 1px solid #d6d8db;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
        ul, ol {
            margin: 10px 0;
            padding-left: 30px;
        }
        li {
            margin: 5px 0;
        }
        .conclusion {
            background-color: #cce5ff;
            border: 1px solid #99d6ff;
            border-radius: 4px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        @media print {
            body {
                background-color: white;
            }
            .container {
                box-shadow: none;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Plan for Filstruktur og Klassebibliotek</h1>
        <h2>IS-115 Prosjektoppgave - Kunnskapsgryta AI Chat Application</h2>

        <h2>1. Nåværende Filstruktur Analyse</h2>

        <h3>1.1 Eksisterende Struktur</h3>
        <div class="file-structure">
IS-115_Prosjektoppgave/
├── assets/
│   ├── css/
│   │   └── style.css
│   └── images/
│       ├── Kunnskapsgryta_Uten_bakgrunn_Ingen_tekst.png
│       ├── Kunnskapsgryta_Uten_bakgrunn.png
│       └── Kunnskapsgryta.png
├── config/
│   ├── instructions_casual.txt
│   ├── instructions_debugger.txt
│   ├── instructions_default.txt
│   ├── instructions_mealplanner.txt
│   └── instructions_tutor.txt
├── includes/
│   └── session_functions.php
├── src/ (tom)
├── vendor/ (Composer dependencies)
├── chat_ajax.php
├── composer.json
├── composer.lock
├── example.env
├── index.php
├── index_meal.php
└── README.md
        </div>

        <h3>1.2 Identifiserte Problemer</h3>
        <ul>
            <li><strong>Manglende MVC-struktur</strong>: Kode er blandet i enkeltfiler</li>
            <li><strong>Ingen klasser</strong>: Alt er skrevet som prosedyrisk PHP</li>
            <li><strong>Dårlig separasjon</strong>: Business logic blandet med presentasjon</li>
            <li><strong>Ingen autoloading</strong>: Manuell inkludering av filer</li>
            <li><strong>Manglende validering</strong>: Ingen sentralisert input-validering</li>
            <li><strong>Ingen error handling</strong>: Manglende sentralisert feilhåndtering</li>
        </ul>

        <h2>2. Foreslått Ny Filstruktur</h2>

        <h3>2.1 MVC-basert Struktur</h3>
        <div class="file-structure">
IS-115_Prosjektoppgave/
├── app/
│   ├── Controllers/
│   │   ├── ChatController.php
│   │   ├── SessionController.php
│   │   └── MealController.php
│   ├── Models/
│   │   ├── ChatModel.php
│   │   ├── SessionModel.php
│   │   ├── UserModel.php
│   │   └── MealModel.php
│   ├── Views/
│   │   ├── templates/
│   │   │   ├── header.php
│   │   │   ├── footer.php
│   │   │   └── sidebar.php
│   │   ├── chat/
│   │   │   ├── index.php
│   │   │   └── meal_form.php
│   │   └── errors/
│   │       ├── 404.php
│   │       └── 500.php
│   └── Services/
│       ├── GeminiService.php
│       ├── SessionService.php
│       └── ValidationService.php
├── config/
│   ├── app.php
│   ├── database.php
│   ├── gemini.php
│   └── instructions/
│       ├── casual.txt
│       ├── debugger.txt
│       ├── default.txt
│       ├── mealplanner.txt
│       └── tutor.txt
├── public/
│   ├── assets/
│   │   ├── css/
│   │   │   ├── main.css
│   │   │   ├── chat.css
│   │   │   └── responsive.css
│   │   ├── js/
│   │   │   ├── main.js
│   │   │   ├── chat.js
│   │   │   └── session.js
│   │   └── images/
│   │       ├── logo.png
│   │       └── icons/
│   ├── index.php (entry point)
│   └── ajax/
│       └── chat.php
├── src/
│   ├── Core/
│   │   ├── Application.php
│   │   ├── Router.php
│   │   ├── Request.php
│   │   ├── Response.php
│   │   └── Database.php
│   ├── Classes/
│   │   ├── Chat/
│   │   │   ├── ChatManager.php
│   │   │   ├── Message.php
│   │   │   └── Conversation.php
│   │   ├── Session/
│   │   │   ├── SessionManager.php
│   │   │   └── SessionData.php
│   │   ├── User/
│   │   │   ├── User.php
│   │   │   └── UserPreferences.php
│   │   └── Meal/
│   │       ├── MealPlanner.php
│   │       ├── Recipe.php
│   │       └── Ingredient.php
│   ├── Interfaces/
│   │   ├── ChatInterface.php
│   │   ├── SessionInterface.php
│   │   └── ValidationInterface.php
│   └── Traits/
│       ├── Loggable.php
│       ├── Validatable.php
│       └── Cacheable.php
├── storage/
│   ├── logs/
│   ├── cache/
│   └── sessions/
├── tests/
│   ├── Unit/
│   ├── Integration/
│   └── Feature/
├── vendor/ (Composer dependencies)
├── .env
├── .env.example
├── composer.json
├── composer.lock
└── README.md
        </div>

        <h2>3. Klassebibliotek Design</h2>

        <h3>3.1 Core Classes</h3>

        <h4>3.1.1 Application.php</h4>
        <div class="code-block">
&lt;?php
namespace App\Core;

class Application {
    private $router;
    private $request;
    private $response;
    
    public function __construct() {
        $this->router = new Router();
        $this->request = new Request();
        $this->response = new Response();
    }
    
    public function run() {
        // Main application logic
    }
    
    public function getRouter() {
        return $this->router;
    }
}
        </div>

        <h4>3.1.2 ChatManager.php</h4>
        <div class="code-block">
&lt;?php
namespace App\Classes\Chat;

use App\Services\GeminiService;
use App\Classes\Session\SessionManager;

class ChatManager {
    private $geminiService;
    private $sessionManager;
    
    public function __construct(GeminiService $geminiService, SessionManager $sessionManager) {
        $this->geminiService = $geminiService;
        $this->sessionManager = $sessionManager;
    }
    
    public function sendMessage(string $message, string $sessionId): array {
        // Send message logic
    }
    
    public function getChatHistory(string $sessionId): array {
        // Get chat history logic
    }
}
        </div>

        <h4>3.1.3 SessionManager.php</h4>
        <div class="code-block">
&lt;?php
namespace App\Classes\Session;

class SessionManager {
    private $sessions = [];
    
    public function createSession(): string {
        // Create new session logic
    }
    
    public function getSession(string $sessionId): ?SessionData {
        // Get session logic
    }
    
    public function updateSession(string $sessionId, array $data): bool {
        // Update session logic
    }
    
    public function deleteSession(string $sessionId): bool {
        // Delete session logic
    }
    
    public function getAllSessions(): array {
        // Get all sessions logic
    }
}
        </div>

        <h3>3.2 Meal Planning Classes</h3>

        <h4>3.2.1 MealPlanner.php</h4>
        <div class="code-block">
&lt;?php
namespace App\Classes\Meal;

use App\Classes\User\UserPreferences;

class MealPlanner {
    private $userPreferences;
    
    public function __construct(UserPreferences $userPreferences) {
        $this->userPreferences = $userPreferences;
    }
    
    public function generateMealPlan(int $days = 7): array {
        // Generate meal plan logic
    }
    
    public function generateShoppingList(array $mealPlan): array {
        // Generate shopping list logic
    }
    
    public function getRecipes(array $mealPlan): array {
        // Get recipes logic
    }
}
        </div>

        <h4>3.2.2 UserPreferences.php</h4>
        <div class="code-block">
&lt;?php
namespace App\Classes\User;

class UserPreferences {
    private $dietType;
    private $allergies;
    private $likes;
    private $dislikes;
    private $budget;
    private $equipment;
    private $cookTime;
    private $mealsPerDay;
    private $peopleAmount;
    
    public function __construct(array $preferences) {
        $this->dietType = $preferences['dietType'] ?? '';
        $this->allergies = $preferences['allergies'] ?? [];
        $this->likes = $preferences['likes'] ?? '';
        $this->dislikes = $preferences['dislikes'] ?? '';
        $this->budget = $preferences['budget'] ?? 0;
        $this->equipment = $preferences['equipment'] ?? '';
        $this->cookTime = $preferences['cookTime'] ?? 0;
        $this->mealsPerDay = $preferences['mealsPerDay'] ?? 3;
        $this->peopleAmount = $preferences['peopleAmount'] ?? 1;
    }
    
    // Getters and setters
    public function getDietType(): string {
        return $this->dietType;
    }
    
    public function getAllergies(): array {
        return $this->allergies;
    }
    
    public function getBudget(): int {
        return $this->budget;
    }
}
        </div>

        <h2>4. Include Files og Dependencies</h2>

        <h3>4.1 Composer Autoloading</h3>
        <div class="code-block">
{
    "autoload": {
        "psr-4": {
            "App\\": "app/",
            "App\\Classes\\": "src/Classes/",
            "App\\Core\\": "src/Core/",
            "App\\Services\\": "app/Services/"
        }
    }
}
        </div>

        <h3>4.2 Bootstrap File</h3>
        <div class="code-block">
&lt;?php
// bootstrap.php
require_once __DIR__ . '/vendor/autoload.php';

// Load environment variables
$dotenv = Dotenv\Dotenv::createImmutable(__DIR__);
$dotenv->load();

// Start session
session_start();

// Initialize application
$app = new App\Core\Application();
        </div>

        <h2>5. Fordeler med Ny Struktur</h2>

        <div class="benefits">
            <h3>5.1 Kodeorganisering</h3>
            <ul>
                <li><strong>Separasjon av ansvar</strong>: Hver klasse har et spesifikt ansvar</li>
                <li><strong>Gjenbrukbarhet</strong>: Klassen kan brukes i andre deler av applikasjonen</li>
                <li><strong>Testbarhet</strong>: Enklere å skrive unit tests</li>
                <li><strong>Vedlikeholdbarhet</strong>: Lettere å finne og endre kode</li>
            </ul>

            <h3>5.2 Sikkerhet</h3>
            <ul>
                <li><strong>Input validering</strong>: Sentralisert validering av brukerinput</li>
                <li><strong>XSS beskyttelse</strong>: Automatisk escaping av output</li>
                <li><strong>CSRF beskyttelse</strong>: Token-basert beskyttelse</li>
                <li><strong>SQL injection</strong>: Prepared statements</li>
            </ul>

            <h3>5.3 Ytelse</h3>
            <ul>
                <li><strong>Autoloading</strong>: Automatisk lasting av klasser</li>
                <li><strong>Caching</strong>: Mulighet for caching av data</li>
                <li><strong>Database optimalisering</strong>: Bedre database queries</li>
                <li><strong>Minimering</strong>: Minimerte CSS/JS filer</li>
            </ul>

            <h3>5.4 Skalerbarhet</h3>
            <ul>
                <li><strong>Modulær arkitektur</strong>: Enkle å legge til nye funksjoner</li>
                <li><strong>API-ready</strong>: Strukturert for fremtidige API endpoints</li>
                <li><strong>Database abstraksjon</strong>: Enkelt å bytte database</li>
                <li><strong>Microservices</strong>: Kan deles opp i mindre tjenester</li>
            </ul>
        </div>

        <h2>6. Implementeringsplan</h2>

        <div class="phase">
            <h3>6.1 Fase 1: Core Infrastructure</h3>
            <ol>
                <li>Opprett ny mappestruktur</li>
                <li>Implementer Core klasser (Application, Router, Request, Response)</li>
                <li>Sett opp autoloading</li>
                <li>Migrer eksisterende funksjonalitet</li>
            </ol>
        </div>

        <div class="phase">
            <h3>6.2 Fase 2: Chat Funksjonalitet</h3>
            <ol>
                <li>Implementer ChatManager og Message klasser</li>
                <li>Migrer session management</li>
                <li>Oppdater AJAX endpoints</li>
                <li>Test chat funksjonalitet</li>
            </ol>
        </div>

        <div class="phase">
            <h3>6.3 Fase 3: Meal Planning</h3>
            <ol>
                <li>Implementer MealPlanner og UserPreferences klasser</li>
                <li>Migrer meal form funksjonalitet</li>
                <li>Integrer med chat system</li>
                <li>Test meal planning</li>
            </ol>
        </div>

        <div class="phase">
            <h3>6.4 Fase 4: Forbedringer</h3>
            <ol>
                <li>Legg til validering og error handling</li>
                <li>Implementer logging</li>
                <li>Legg til caching</li>
                <li>Optimaliser ytelse</li>
            </ol>
        </div>

        <div class="conclusion">
            <h2>7. Konklusjon</h2>
            <p>Den foreslåtte strukturen gir en solid grunnlag for en skalerbar og vedlikeholdbar webapplikasjon. Ved å implementere MVC-arkitektur og et godt designet klassebibliotek, vil applikasjonen bli:</p>
            <ul style="text-align: left; display: inline-block;">
                <li><strong>Mer organisert</strong>: Tydelig separasjon av ansvar</li>
                <li><strong>Mer sikker</strong>: Sentralisert validering og beskyttelse</li>
                <li><strong>Mer testbar</strong>: Enklere å skrive og kjøre tester</li>
                <li><strong>Mer skalerbar</strong>: Enkelt å legge til nye funksjoner</li>
                <li><strong>Mer vedlikeholdbar</strong>: Lettere å finne og endre kode</li>
            </ul>
            <p>Denne strukturen følger moderne PHP best practices og gir en solid grunnlag for fremtidig utvikling av Kunnskapsgryta applikasjonen.</p>
        </div>
    </div>
</body>
</html>
